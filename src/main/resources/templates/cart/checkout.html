<!DOCTYPE html>
<html lang="vi" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Thanh toán - Gaming Shop</title>
</head>
<body>
    <div layout:fragment="content">
        
        <!-- Breadcrumb -->
        <section class="breadcrumb-section py-3 bg-light">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
                        <li class="breadcrumb-item"><a href="/cart">Giỏ hàng</a></li>
                        <li class="breadcrumb-item active">Thanh toán</li>
                    </ol>
                </nav>
            </div>
        </section>
        
        <!-- Checkout Section -->
        <section class="checkout-section py-5">
            <div class="container">
                
                <!-- Page Header -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="fw-bold">
                            <i class="bi bi-credit-card text-success me-2"></i>
                            Thanh toán
                        </h2>
                    </div>
                </div>
                
                <!-- Error Message -->
                <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <span th:text="${errorMessage}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                
                <form th:action="@{/checkout/place-order}" method="post">
                    <div class="row g-4">
                        
                        <!-- Shipping Information -->
                        <div class="col-lg-7">
                            
                            <!-- Customer Info -->
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-header bg-dark text-white">
                                    <h5 class="mb-0">
                                        <i class="bi bi-person-fill me-2"></i>
                                        Thông tin người nhận
                                    </h5>
                                </div>
                                <div class="card-body">
                                    
                                    <div class="row g-3">
                                        <!-- Tên người nhận -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">
                                                Họ và tên <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   name="tenNguoiNhan"
                                                   th:value="${user != null ? user.ten : ''}"
                                                   placeholder="Nguyễn Văn A"
                                                   required>
                                        </div>
                                        
                                        <!-- Số điện thoại -->
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">
                                                Số điện thoại <span class="text-danger">*</span>
                                            </label>
                                            <input type="tel" 
                                                   class="form-control" 
                                                   name="sdtNguoiNhan"
                                                   th:value="${user != null ? user.soDienThoai : ''}"
                                                   placeholder="0987654321"
                                                   required>
                                        </div>
                                        
                                        <!-- Email -->
                                        <div class="col-12">
                                            <label class="form-label fw-bold">Email</label>
                                            <input type="email" 
                                                   class="form-control" 
                                                   th:value="${user != null ? user.email : ''}"
                                                   placeholder="email@example.com">
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <!-- Shipping Address -->
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">
                                        <i class="bi bi-geo-alt-fill me-2"></i>
                                        Địa chỉ giao hàng
                                    </h5>
                                </div>
                                <div class="card-body">
                                    
                                    <div class="row g-3">
                                        <!-- Địa chỉ chi tiết -->
                                        <div class="col-12">
                                            <label class="form-label fw-bold">
                                                Địa chỉ chi tiết <span class="text-danger">*</span>
                                            </label>
                                            <textarea class="form-control" 
                                                      name="diaChiGiaoHang"
                                                      rows="3"
                                                      placeholder="Số nhà, tên đường, phường/xã, quận/huyện, tỉnh/thành phố"
                                                      required></textarea>
                                            <small class="text-muted">
                                                VD: 123 Nguyễn Huệ, Phường Bến Nghé, Quận 1, TP. Hồ Chí Minh
                                            </small>
                                        </div>
                                        
                                        <!-- Ghi chú -->
                                        <div class="col-12">
                                            <label class="form-label fw-bold">Ghi chú đơn hàng (tùy chọn)</label>
                                            <textarea class="form-control" 
                                                      name="ghiChu"
                                                      rows="2"
                                                      placeholder="Ghi chú về đơn hàng, ví dụ: thời gian hay chỉ dẫn địa điểm giao hàng chi tiết hơn."></textarea>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <!-- Payment Method -->
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">
                                        <i class="bi bi-wallet2 me-2"></i>
                                        Phương thức thanh toán
                                    </h5>
                                </div>
                                <div class="card-body">
                                    
                                    <div class="payment-methods">
                                        <!-- COD -->
                                        <div class="form-check mb-3 p-3 border rounded">
                                            <input class="form-check-input" 
                                                   type="radio" 
                                                   name="paymentMethod" 
                                                   id="cod"
                                                   value="cod"
                                                   checked>
                                            <label class="form-check-label w-100" for="cod">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-cash-coin fs-2 text-success me-3"></i>
                                                    <div>
                                                        <strong>Thanh toán khi nhận hàng (COD)</strong>
                                                        <br>
                                                        <small class="text-muted">
                                                            Thanh toán bằng tiền mặt khi nhận hàng
                                                        </small>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                        
                                        <!-- Bank Transfer (disabled) -->
                                        <div class="form-check mb-3 p-3 border rounded bg-light">
                                            <input class="form-check-input" 
                                                   type="radio" 
                                                   name="paymentMethod" 
                                                   id="bank"
                                                   value="bank"
                                                   disabled>
                                            <label class="form-check-label w-100" for="bank">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-bank fs-2 text-muted me-3"></i>
                                                    <div>
                                                        <strong class="text-muted">Chuyển khoản ngân hàng</strong>
                                                        <br>
                                                        <small class="text-muted">
                                                            Tính năng đang phát triển
                                                        </small>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="col-lg-5">
                            <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
                                <div class="card-header bg-danger text-white">
                                    <h5 class="mb-0">
                                        <i class="bi bi-bag-check me-2"></i>
                                        Đơn hàng của bạn
                                    </h5>
                                </div>
                                <div class="card-body">
                                    
                                    <!-- Cart Items -->
                                    <div class="order-items mb-3" style="max-height: 300px; overflow-y: auto;">
                                        <div th:each="item : ${cartItems}" class="d-flex mb-3 pb-3 border-bottom">
                                            <img th:src="${item.sanPham.hinhAnh != null ? '/images/products/' + item.sanPham.hinhAnh : 'https://via.placeholder.com/60'}" 
                                                 class="rounded me-3"
                                                 style="width: 60px; height: 60px; object-fit: cover;">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1" th:text="${item.sanPham.tenSanPham}">Product</h6>
                                                <small class="text-muted">
                                                    Số lượng: <span th:text="${item.soLuong}">1</span>
                                                </small>
                                            </div>
                                            <div class="text-end">
                                                <strong class="text-danger">
                                                    [[${#numbers.formatInteger(item.sanPham.giaSauGiam * item.soLuong, 0, 'COMMA')}]]₫
                                                </strong>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Pricing -->
                                    <div class="pricing">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Tạm tính:</span>
                                            <strong th:text="${#numbers.formatInteger(total, 0, 'COMMA')} + '₫'">0₫</strong>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Phí vận chuyển:</span>
                                            <strong class="text-success">Miễn phí</strong>
                                        </div>
                                        
                                        <hr>
                                        
                                        <div class="d-flex justify-content-between mb-4">
                                            <h5 class="mb-0">Tổng cộng:</h5>
                                            <h4 class="mb-0 text-danger" 
                                                th:text="${#numbers.formatInteger(total, 0, 'COMMA')} + '₫'">
                                                0₫
                                            </h4>
                                        </div>
                                    </div>
                                    
                                    <!-- Place Order Button -->
                                    <button type="submit" class="btn btn-danger btn-lg w-100 mb-3">
                                        <i class="bi bi-check-circle me-2"></i>
                                        Đặt hàng
                                    </button>
                                    
                                    <a href="/cart" class="btn btn-outline-secondary w-100">
                                        <i class="bi bi-arrow-left me-2"></i>
                                        Quay lại giỏ hàng
                                    </a>
                                    
                                    <!-- Security Notice -->
                                    <div class="alert alert-light mt-3 mb-0">
                                        <small class="text-muted">
                                            <i class="bi bi-shield-check text-success me-1"></i>
                                            Thông tin của bạn được bảo mật an toàn
                                        </small>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </form>
                
            </div>
        </section>
        
    </div>
</body>
</html>