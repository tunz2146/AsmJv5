<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle ?: 'Sản phẩm'} + ' - Gaming Shop'">Sản phẩm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        :root {
            --primary-color: #00ff88;
            --bg-dark: #0a0e27;
            --bg-card: #1a1f3a;
            --text-primary: #ffffff;
            --text-secondary: #b0b8d4;
        }
        body { background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%); color: var(--text-primary); }
        .product-card { background: var(--bg-card); border: 1px solid rgba(0, 255, 136, 0.2); border-radius: 10px; padding: 1.5rem; transition: all 0.3s ease; }
        .product-card:hover { border-color: var(--primary-color); transform: translateY(-5px); box-shadow: 0 8px 24px rgba(0, 255, 136, 0.2); }
        .product-card img { width: 100%; height: 250px; object-fit: cover; border-radius: 8px; margin-bottom: 1rem; }
        .product-price { font-size: 1.5rem; color: var(--primary-color); font-weight: 700; }
    </style>
</head>
<body>
    <!-- Header -->
    <div th:replace="~{layout/header :: header}"></div>
    
    <main>
        
        <!-- BREADCRUMB -->
        <section class="breadcrumb-section">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/}"><i class="fas fa-home me-2"></i>Trang chủ</a></li>
                        <li class="breadcrumb-item active" aria-current="page">
                            <span th:if="${category != null}" th:text="${category.ten}">Sản phẩm</span>
                            <span th:unless="${category != null}">Tất cả sản phẩm</span>
                        </li>
                    </ol>
                </nav>
            </div>
        </section>

        <!-- PRODUCTS LISTING -->
        <section class="products-listing-section">
            <div class="container">
                <div class="row">
                    
                    <!-- SIDEBAR FILTERS -->
                    <div class="col-lg-3">
                        <div class="filters-sidebar">
                            <!-- Mobile Filter Toggle -->
                            <button class="btn btn-primary w-100 d-lg-none mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse">
                                <i class="fas fa-filter me-2"></i>
                                Bộ lọc
                            </button>
                            
                            <div class="collapse d-lg-block" id="filterCollapse">
                                <!-- Categories Filter -->
                                <div class="filter-widget">
                                    <h5 class="filter-title">
                                        <i class="fas fa-th-large me-2"></i>
                                        Danh mục
                                    </h5>
                                    <div class="filter-options">
                                        <div class="form-check" th:each="cat : ${categories}">
                                            <input class="form-check-input" type="checkbox" 
                                                   th:id="'cat-' + ${cat.id}"
                                                   th:value="${cat.id}"
                                                   name="category">
                                            <label class="form-check-label" th:for="'cat-' + ${cat.id}">
                                                <span th:text="${cat.ten}">Chuột Gaming</span>
                                                <span class="item-count" th:text="'(' + ${cat.soLuong} + ')'">(45)</span>
                                            </label>
                                        </div>
                                        
                                        <!-- Fallback khi chưa có data -->
                                        <div class="form-check" th:remove="all">
                                            <input class="form-check-input" type="checkbox" id="cat1">
                                            <label class="form-check-label" for="cat1">
                                                Chuột Gaming <span class="item-count">(120)</span>
                                            </label>
                                        </div>
                                        <div class="form-check" th:remove="all">
                                            <input class="form-check-input" type="checkbox" id="cat2">
                                            <label class="form-check-label" for="cat2">
                                                Bàn Phím Cơ <span class="item-count">(80)</span>
                                            </label>
                                        </div>
                                        <div class="form-check" th:remove="all">
                                            <input class="form-check-input" type="checkbox" id="cat3">
                                            <label class="form-check-label" for="cat3">
                                                Tai Nghe Gaming <span class="item-count">(65)</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Brands Filter -->
                                <div class="filter-widget">
                                    <h5 class="filter-title">
                                        <i class="fas fa-tag me-2"></i>
                                        Thương hiệu
                                    </h5>
                                    <div class="filter-options">
                                        <div class="form-check" th:each="brand : ${brands}">
                                            <input class="form-check-input" type="checkbox" 
                                                   th:id="'brand-' + ${brand.id}"
                                                   th:value="${brand.id}"
                                                   name="brand">
                                            <label class="form-check-label" th:for="'brand-' + ${brand.id}">
                                                <span th:text="${brand.tenHang}">Logitech</span>
                                            </label>
                                        </div>
                                        
                                        <!-- Fallback -->
                                        <div class="form-check" th:remove="all">
                                            <input class="form-check-input" type="checkbox" id="brand1">
                                            <label class="form-check-label" for="brand1">Logitech</label>
                                        </div>
                                        <div class="form-check" th:remove="all">
                                            <input class="form-check-input" type="checkbox" id="brand2">
                                            <label class="form-check-label" for="brand2">Razer</label>
                                        </div>
                                        <div class="form-check" th:remove="all">
                                            <input class="form-check-input" type="checkbox" id="brand3">
                                            <label class="form-check-label" for="brand3">Corsair</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Price Range Filter -->
                                <div class="filter-widget">
                                    <h5 class="filter-title">
                                        <i class="fas fa-dollar-sign me-2"></i>
                                        Khoảng giá
                                    </h5>
                                    <div class="filter-options">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="priceRange" id="price1" value="0-500000">
                                            <label class="form-check-label" for="price1">Dưới 500K</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="priceRange" id="price2" value="500000-1000000">
                                            <label class="form-check-label" for="price2">500K - 1 triệu</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="priceRange" id="price3" value="1000000-2000000">
                                            <label class="form-check-label" for="price3">1 triệu - 2 triệu</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="priceRange" id="price4" value="2000000-5000000">
                                            <label class="form-check-label" for="price4">2 triệu - 5 triệu</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="priceRange" id="price5" value="5000000-999999999">
                                            <label class="form-check-label" for="price5">Trên 5 triệu</label>
                                        </div>
                                    </div>
                                    
                                    <!-- Custom Price Range -->
                                    <div class="custom-price-range mt-3">
                                        <label class="form-label">Tùy chỉnh giá:</label>
                                        <div class="d-flex gap-2 align-items-center">
                                            <input type="number" class="form-control form-control-sm" placeholder="Từ" id="minPrice">
                                            <span>-</span>
                                            <input type="number" class="form-control form-control-sm" placeholder="Đến" id="maxPrice">
                                        </div>
                                    </div>
                                </div>

                                <!-- Rating Filter -->
                                <div class="filter-widget">
                                    <h5 class="filter-title">
                                        <i class="fas fa-star me-2"></i>
                                        Đánh giá
                                    </h5>
                                    <div class="filter-options">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="rating" id="rating5" value="5">
                                            <label class="form-check-label" for="rating5">
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="rating" id="rating4" value="4">
                                            <label class="form-check-label" for="rating4">
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="far fa-star text-warning"></i>
                                                trở lên
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="rating" id="rating3" value="3">
                                            <label class="form-check-label" for="rating3">
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="fas fa-star text-warning"></i>
                                                <i class="far fa-star text-warning"></i>
                                                <i class="far fa-star text-warning"></i>
                                                trở lên
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Filter Actions -->
                                <div class="filter-actions">
                                    <button class="btn btn-primary w-100 mb-2" onclick="applyFilters()">
                                        <i class="fas fa-check me-2"></i>
                                        Áp dụng
                                    </button>
                                    <button class="btn btn-outline w-100" onclick="resetFilters()">
                                        <i class="fas fa-redo me-2"></i>
                                        Đặt lại
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PRODUCTS GRID -->
                    <div class="col-lg-9">
                        <!-- Toolbar -->
                        <div class="products-toolbar">
                            <div class="toolbar-left">
                                <span class="results-count">
                                    Hiển thị 
                                    <strong th:text="${products?.size() ?: 12}">12</strong> 
                                    trong 
                                    <strong th:text="${totalProducts ?: 45}">45</strong> 
                                    sản phẩm
                                </span>
                            </div>
                            <div class="toolbar-right">
                                <!-- View Mode Toggle -->
                                <div class="view-mode-toggle">
                                    <button class="view-btn active" data-view="grid" onclick="changeView('grid')">
                                        <i class="fas fa-th"></i>
                                    </button>
                                    <button class="view-btn" data-view="list" onclick="changeView('list')">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                                
                                <!-- Sort Dropdown -->
                                <select class="form-select sort-select" onchange="sortProducts(this.value)">
                                    <option value="default">Mặc định</option>
                                    <option value="price-asc">Giá: Thấp đến cao</option>
                                    <option value="price-desc">Giá: Cao đến thấp</option>
                                    <option value="name-asc">Tên: A-Z</option>
                                    <option value="name-desc">Tên: Z-A</option>
                                    <option value="newest">Mới nhất</option>
                                    <option value="bestseller">Bán chạy nhất</option>
                                </select>
                            </div>
                        </div>

                        <!-- Active Filters Tags -->
                        <div class="active-filters" id="activeFilters">
                            <!-- Will be populated by JavaScript -->
                        </div>

                        <!-- Products Grid -->
                        <div class="products-grid" id="productsGrid">
                            <div class="row g-4">
                                <!-- Product Item -->
                                <div class="col-lg-4 col-md-6" th:each="product : ${products}" data-animate>
                                    <div class="product-card">
                                        <div class="product-card-img-wrapper">
                                            <span class="product-badge" th:if="${product.discountPrice != null}">
                                                -<span th:text="${product.getDiscountPercentage()}">19</span>%
                                            </span>
                                            <img th:src="@{'/images/products/' + ${product.imageUrl}}" 
                                                 th:alt="${product.name}"
                                                 src="https://via.placeholder.com/300x300/0a0e27/00ff88?text=Gaming+Product">
                                            <div class="product-quick-actions">
                                                <a th:href="@{'/san-pham/' + ${product.id}}" class="btn-quick-view">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <button class="btn-add-cart" th:onclick="'addToCart(' + ${product.id} + ', \'' + ${product.name} + '\')'">
                                                    <i class="fas fa-shopping-cart"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="product-card-body">
                                            <span class="product-brand" th:text="${product.category?.name}">Gaming</span>
                                            <h5 class="product-title">
                                                <a th:href="@{'/san-pham/' + ${product.id}}" th:text="${product.name}">
                                                    Gaming Product
                                                </a>
                                            </h5>
                                            <div class="product-rating">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star-half-alt"></i>
                                                <span>(5.0)</span>
                                            </div>
                                            <div class="product-price-wrapper">
                                                <span class="product-price-original" th:if="${product.discountPrice != null}">
                                                    <span th:text="${#numbers.formatInteger(product.price, 0, 'COMMA')}">1,590,000</span>₫
                                                </span>
                                                <span class="product-price">
                                                    <span th:text="${#numbers.formatInteger(product.getFinalPrice(), 0, 'COMMA')}">1,290,000</span>₫
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Fallback products -->
                                <div class="col-lg-4 col-md-6" data-animate th:remove="all">
                                    <div class="product-card">
                                        <div class="product-card-img-wrapper">
                                            <span class="product-badge">-19%</span>
                                            <img src="https://via.placeholder.com/300x300/0a0e27/00ff88?text=Product+1" alt="Product">
                                            <div class="product-quick-actions">
                                                <button class="btn-quick-view"><i class="fas fa-eye"></i></button>
                                                <button class="btn-add-cart"><i class="fas fa-shopping-cart"></i></button>
                                            </div>
                                        </div>
                                        <div class="product-card-body">
                                            <span class="product-brand">Logitech</span>
                                            <h5 class="product-title">Logitech G502 HERO</h5>
                                            <div class="product-rating">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star-half-alt"></i>
                                                <span>(4.5)</span>
                                            </div>
                                            <div class="product-price-wrapper">
                                                <span class="product-price-original">1,590,000₫</span>
                                                <span class="product-price">1,290,000₫</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Repeat for more products -->
                                <div class="col-lg-4 col-md-6" data-animate th:remove="all">
                                    <div class="product-card">
                                        <div class="product-card-img-wrapper">
                                            <img src="https://via.placeholder.com/300x300/0a0e27/00ff88?text=Product+2" alt="Product">
                                            <div class="product-quick-actions">
                                                <button class="btn-quick-view"><i class="fas fa-eye"></i></button>
                                                <button class="btn-add-cart"><i class="fas fa-shopping-cart"></i></button>
                                            </div>
                                        </div>
                                        <div class="product-card-body">
                                            <span class="product-brand">Razer</span>
                                            <h5 class="product-title">Razer DeathAdder V3</h5>
                                            <div class="product-rating">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <span>(5.0)</span>
                                            </div>
                                            <div class="product-price-wrapper">
                                                <span class="product-price">1,890,000₫</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Product pagination" class="mt-5">
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item"><a class="page-link" href="#">4</a></li>
                                <li class="page-item"><a class="page-link" href="#">5</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <div th:replace="~{layout/footer :: footer}"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<script>
// Apply Filters
function applyFilters() {
    const categories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value);
    const brands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(cb => cb.value);
    const priceRange = document.querySelector('input[name="priceRange"]:checked')?.value;
    const rating = document.querySelector('input[name="rating"]:checked')?.value;
    
    // Build query string
    const params = new URLSearchParams();
    if (categories.length) params.append('categories', categories.join(','));
    if (brands.length) params.append('brands', brands.join(','));
    if (priceRange) params.append('price', priceRange);
    if (rating) params.append('rating', rating);
    
    // Redirect with filters
    window.location.href = '/san-pham?' + params.toString();
}

// Reset Filters
function resetFilters() {
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
    document.getElementById('minPrice').value = '';
    document.getElementById('maxPrice').value = '';
    window.location.href = '/san-pham';
}

// Change View Mode
function changeView(mode) {
    const grid = document.getElementById('productsGrid');
    const buttons = document.querySelectorAll('.view-btn');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-view="${mode}"]`).classList.add('active');
    
    if (mode === 'list') {
        grid.classList.add('list-view');
    } else {
        grid.classList.remove('list-view');
    }
}

// Sort Products
function sortProducts(sortType) {
    const params = new URLSearchParams(window.location.search);
    params.set('sort', sortType);
    window.location.href = '/san-pham?' + params.toString();
}
</script>

<style>
/* Breadcrumb */
.breadcrumb-section {
    padding: 1.5rem 0;
    background: var(--bg-card);
    border-bottom: 1px solid rgba(0, 255, 136, 0.1);
}

.breadcrumb {
    background: transparent;
    margin: 0;
    padding: 0;
}

.breadcrumb-item a {
    color: var(--text-secondary);
    text-decoration: none;
}

.breadcrumb-item a:hover {
    color: var(--primary-color);
}

.breadcrumb-item.active {
    color: var(--primary-color);
}

/* Products Listing */
.products-listing-section {
    padding: 2rem 0 4rem 0;
}

/* Filters Sidebar */
.filters-sidebar {
    background: var(--bg-card);
    border: 1px solid rgba(0, 255, 136, 0.1);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    position: sticky;
    top: 100px;
}

.filter-widget {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid rgba(0, 255, 136, 0.1);
}

.filter-widget:last-child {
    border-bottom: none;
}

.filter-title {
    font-size: 1rem;
    color: var(--text-primary);
    margin-bottom: 1rem;
    font-weight: 600;
}

.filter-options {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.form-check-label {
    color: var(--text-secondary);
    cursor: pointer;
    width: 100%;
}

.form-check-input:checked ~ .form-check-label {
    color: var(--primary-color);
}

.item-count {
    color: var(--text-muted);
    font-size: 0.875rem;
    float: right;
}

.custom-price-range .form-control {
    background: var(--bg-darker);
    border: 1px solid rgba(0, 255, 136, 0.2);
    color: var(--text-primary);
}

.filter-actions {
    margin-top: 1.5rem;
}

/* Products Toolbar */
.products-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background: var(--bg-card);
    border: 1px solid rgba(0, 255, 136, 0.1);
    border-radius: var(--radius-lg);
    margin-bottom: 2rem;
}

.results-count {
    color: var(--text-secondary);
}

.toolbar-right {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.view-mode-toggle {
    display: flex;
    gap: 0.5rem;
}

.view-btn {
    width: 40px;
    height: 40px;
    border: 1px solid rgba(0, 255, 136, 0.2);
    background: var(--bg-darker);
    color: var(--text-secondary);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: var(--transition-fast);
}

.view-btn:hover,
.view-btn.active {
    background: var(--primary-color);
    color: var(--bg-dark);
    border-color: var(--primary-color);
}

.sort-select {
    background: var(--bg-darker);
    border: 1px solid rgba(0, 255, 136, 0.2);
    color: var(--text-primary);
    min-width: 200px;
}

.sort-select:focus {
    background: var(--bg-darker);
    border-color: var(--primary-color);
    color: var(--text-primary);
}

/* Active Filters */
.active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.filter-tag {
    background: var(--bg-card);
    border: 1px solid var(--primary-color);
    padding: 0.5rem 1rem;
    border-radius: 50px;
    color: var(--text-primary);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-tag button {
    background: none;
    border: none;
    color: var(--primary-color);
    cursor: pointer;
    padding: 0;
}

/* Products Grid */
.products-grid {
    margin-bottom: 2rem;
}

/* List View */
.products-grid.list-view .row {
    flex-direction: column;
}

.products-grid.list-view .product-card {
    display: flex;
    flex-direction: row;
}

.products-grid.list-view .product-card-img-wrapper {
    width: 250px;
    flex-shrink: 0;
}

.products-grid.list-view .product-card-body {
    flex: 1;
    padding: 1.5rem;
}

/* Pagination */
.pagination {
    --bs-pagination-bg: var(--bg-card);
    --bs-pagination-border-color: rgba(0, 255, 136, 0.2);
    --bs-pagination-color: var(--text-secondary);
    --bs-pagination-hover-bg: var(--bg-darker);
    --bs-pagination-hover-color: var(--primary-color);
    --bs-pagination-active-bg: var(--primary-color);
    --bs-pagination-active-color: var(--bg-dark);
    --bs-pagination-active-border-color: var(--primary-color);
}

/* Responsive */
@media (max-width: 991px) {
    .products-toolbar {
        flex-direction: column;
        gap: 1rem;
    }
    
    .toolbar-right {
        width: 100%;
        justify-content: space-between;
    }
    
    .sort-select {
        min-width: auto;
        flex: 1;
    }
}
</style>